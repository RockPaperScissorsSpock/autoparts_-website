{"version":3,"file":"20-B3rq0pZd.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/warehouse/_page.server.js","../../../.svelte-kit/adapter-node/nodes/20.js"],"sourcesContent":["import { r as redirect } from \"../../../chunks/index.js\";\nimport sqlite3 from \"sqlite3\";\nimport { s as set_connection } from \"../../../chunks/legacydb.js\";\nconst sqlite = sqlite3.verbose();\nasync function fetch_parts() {\n  let connection = await set_connection();\n  let res = await connection.query(`SELECT * FROM parts;`).then(([rows, fields]) => {\n    return rows;\n  });\n  return res;\n}\nasync function warehouse_query(id) {\n  return new Promise((resolve, reject) => {\n    let database_instance = new sqlite.Database(\"./db/projectdb.sl3\");\n    database_instance.serialize(() => {\n      let fetch_full_order = `\n      SELECT * FROM Warehouse WHERE PartID = '${id}';\n      `;\n      database_instance.all(fetch_full_order, (error, data) => {\n        if (error)\n          console.log(error);\n        return resolve(data);\n      });\n    });\n  });\n}\nasync function load({ params }) {\n  let parts = await fetch_parts();\n  let warehouse_data = [];\n  for (let i = 0; i < parts.length; ++i) {\n    let whr = await warehouse_query(parts[i].number);\n    let avail = 0;\n    let set = false;\n    if (whr.length == 1) {\n      avail = whr[0].quantity;\n      set = true;\n    }\n    warehouse_data.push({\n      item: parts[i],\n      qty: avail,\n      set,\n      img: parts[i].pictureURL\n    });\n  }\n  return {\n    parts: warehouse_data\n  };\n}\nasync function warehouse_update(id, qty) {\n  let original = await warehouse_query(id);\n  let add = original.length == 0;\n  let query;\n  if (add) {\n    query = `INSERT INTO Warehouse (PartID, quantity) VALUES\n      (${id}, ${qty});`;\n  } else {\n    query = `UPDATE Warehouse SET quantity = \n      ${qty} WHERE PartID = ${id};`;\n  }\n  return new Promise((resolve, reject) => {\n    let database_instance = new sqlite.Database(\"./db/projectdb.sl3\");\n    database_instance.serialize(() => {\n      database_instance.run(query, function() {\n        resolve();\n      });\n    });\n  });\n}\nconst actions = {\n  update: async (request) => {\n    const form_data = await request.request.formData();\n    const id = form_data.get(\"id\");\n    const adjust = form_data.get(\"qty\");\n    if (adjust < 0)\n      redirect(301, \"/warehouse?nonegative\");\n    await warehouse_update(id, adjust);\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/warehouse/_page.server.js';\n\nexport const index = 20;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/warehouse/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/warehouse/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/20.Ew7N7lkk.js\",\"_app/immutable/chunks/14.NBuK3kfd.js\",\"_app/immutable/chunks/index.BkIfBQf8.js\",\"_app/immutable/chunks/each.D6YF6ztN.js\",\"_app/immutable/chunks/helpers.C7bBOv7j.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}