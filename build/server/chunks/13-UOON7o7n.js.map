{"version":3,"file":"13-UOON7o7n.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/order/employee/_manage_/_page.server.js","../../../.svelte-kit/adapter-node/nodes/13.js"],"sourcesContent":["import \"../../../../../chunks/index.js\";\nimport sqlite3 from \"sqlite3\";\nimport { s as set_connection } from \"../../../../../chunks/legacydb.js\";\nimport { a as send_confirmation } from \"../../../../../chunks/mailer.js\";\nconst sqlite = sqlite3.verbose();\nfunction fetch_order(id) {\n  return new Promise((resolve, reject) => {\n    let database_instance = new sqlite.Database(\"./db/projectdb.sl3\");\n    database_instance.serialize(() => {\n      let fetch_full_order = `\n        SELECT * FROM LineItem\n          JOIN Purchase ON Purchase.transaction_ID = LineItem.ID\n          JOIN Customer ON Purchase.Customer_ID = Customer.ID\n          WHERE LineItem.ID = '${id}';\n        `;\n      database_instance.all(fetch_full_order, (error, data) => {\n        if (error)\n          console.log(error);\n        return resolve(data);\n      });\n    });\n  });\n}\nasync function load({ params }) {\n  let order_details = await fetch_order(params.manage);\n  return {\n    order: order_details\n  };\n}\nasync function set_status(id, status) {\n  let statement = `UPDATE Purchase SET order_status = '${status}' WHERE transaction_ID = '${id}';`;\n  return new Promise((resolve, reject) => {\n    let database_instance = new sqlite.Database(\"./db/projectdb.sl3\");\n    database_instance.serialize(() => {\n      database_instance.run(statement, function() {\n        resolve();\n      });\n    });\n  });\n}\nasync function send_email(id) {\n  let order_details = await fetch_order(id);\n  let cart_data = { is_empty: false, items: [], weights: [] };\n  let connection = await set_connection();\n  for (let i = 0; i < order_details.length; ++i) {\n    let res = await connection.query(`SELECT * FROM parts WHERE number = '${order_details.part_number}'`).then(([rows, fields]) => {\n      return rows;\n    });\n    cart_data.items.push({\n      item: res,\n      qty: order_details.quantity\n    });\n  }\n  let details = {\n    first: order_details[0].first_name,\n    last: order_details[0].last_name,\n    email: order_details[0].email,\n    country: order_details[0].country,\n    city: order_details[0].city,\n    state: order_details[0].customer_state,\n    zip: order_details[0].postal_code,\n    addr1: order_details[0].Address_line1,\n    addr2: order_details[0].Address_line2,\n    orderid: id,\n    total: order_details[0].total,\n    cart: cart_data\n  };\n  send_confirmation(order_details[0].email, details);\n}\nconst actions = {\n  shipped: async (request) => {\n    const form_data = await request.request.formData();\n    const id = form_data.get(\"id\");\n    await set_status(id, \"Completed\");\n    await send_email(id);\n  },\n  delivered: async (request) => {\n    const form_data = await request.request.formData();\n    const id = form_data.get(\"id\");\n    await set_status(id, \"Delivered\");\n  },\n  reset: async (request) => {\n    const form_data = await request.request.formData();\n    const id = form_data.get(\"id\");\n    await set_status(id, \"Processing\");\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/order/employee/_manage_/_page.server.js';\n\nexport const index = 13;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/order/employee/_manage_/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/order/employee/[manage]/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/13.BiBXizh2.js\",\"_app/immutable/chunks/14.NBuK3kfd.js\",\"_app/immutable/chunks/index.BkIfBQf8.js\",\"_app/immutable/chunks/each.D6YF6ztN.js\"];\nexport const stylesheets = [\"_app/immutable/assets/13.E6ApfD8M.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}