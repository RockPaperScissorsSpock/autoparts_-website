{"version":3,"file":"5-CbmpkSmR.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/cart/_page.server.js","../../../.svelte-kit/adapter-node/nodes/5.js"],"sourcesContent":["import { c as cart_body } from \"../../../chunks/helpers.js\";\nimport { s as set_connection } from \"../../../chunks/legacydb.js\";\nimport { r as redirect } from \"../../../chunks/index.js\";\nimport sqlite3 from \"sqlite3\";\nconst sqlite = sqlite3.verbose();\nfunction fetch_weights() {\n  return new Promise((resolve, reject) => {\n    let database_instance = new sqlite.Database(\"./db/projectdb.sl3\");\n    database_instance.serialize(() => {\n      let fetch_orders = `\n              SELECT * FROM WeightTable;\n          `;\n      database_instance.all(fetch_orders, (error, data) => {\n        if (error)\n          console.log(error);\n        return resolve(data);\n      });\n    });\n  });\n}\nasync function load({ cookies }) {\n  let current_cart = cookies.get(\"cart\");\n  console.log(current_cart);\n  let cart_items = cart_body();\n  if (current_cart) {\n    cart_items = JSON.parse(current_cart);\n  } else {\n    return { is_empty: true };\n  }\n  let connection = await set_connection();\n  try {\n    let cart_data = { is_empty: false, items: [], weights: [] };\n    for (let i = 0; i < cart_items.items.length; ++i) {\n      let res = await connection.query(`SELECT * FROM parts WHERE number = '${cart_items.items[i].item}'`).then(([rows, fields]) => {\n        return rows;\n      });\n      cart_data.items.push({ item: res[0], qty: cart_items.items[i].qty, img: res[0].pictureURL });\n    }\n    let weight_brackets = await fetch_weights();\n    cart_data.weights = weight_brackets;\n    return cart_data;\n  } catch (error) {\n    console.error(\"Unable to perform query!\");\n    console.log(error);\n    return error;\n  }\n}\nconst actions = {\n  update: async (request) => {\n    const form_data = await request.request.formData();\n    let item_number = form_data.get(\"item\");\n    let item_qty = form_data.get(\"qty\");\n    let current_cart = request.cookies.get(\"cart\");\n    let cart_body$1 = cart_body();\n    if (!(current_cart == null || current_cart == \"\")) {\n      let cookie_cart = JSON.parse(current_cart);\n      cookie_cart.items.forEach((item) => {\n        if (item.item == item_number) {\n          if (Number(item_qty) > 0) {\n            item.qty = Number(item_qty);\n            cart_body$1.items.push(item);\n          }\n        } else {\n          cart_body$1.items.push(item);\n        }\n      });\n      if (cart_body$1.items.length == 0) {\n        request.cookies.delete(\"cart\", { path: \"/\" });\n        redirect(301, \"/cart\");\n      } else {\n        let cookie_string = JSON.stringify(cart_body$1);\n        console.log(cookie_string);\n        request.cookies.set(\"cart\", cookie_string, { path: \"/\" });\n        redirect(301, \"/cart\");\n      }\n    }\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/cart/_page.server.js';\n\nexport const index = 5;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/cart/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/cart/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/5.BQK6O2h9.js\",\"_app/immutable/chunks/14.NBuK3kfd.js\",\"_app/immutable/chunks/index.BkIfBQf8.js\",\"_app/immutable/chunks/each.D6YF6ztN.js\",\"_app/immutable/chunks/helpers.C7bBOv7j.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":";;;;;;AAIA,MAAM,MAAM,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;AACjC,SAAS,aAAa,GAAG;AACzB,EAAE,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;AAC1C,IAAI,IAAI,iBAAiB,GAAG,IAAI,MAAM,CAAC,QAAQ,CAAC,oBAAoB,CAAC,CAAC;AACtE,IAAI,iBAAiB,CAAC,SAAS,CAAC,MAAM;AACtC,MAAM,IAAI,YAAY,GAAG,CAAC;AAC1B;AACA,UAAU,CAAC,CAAC;AACZ,MAAM,iBAAiB,CAAC,GAAG,CAAC,YAAY,EAAE,CAAC,KAAK,EAAE,IAAI,KAAK;AAC3D,QAAQ,IAAI,KAAK;AACjB,UAAU,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AAC7B,QAAQ,OAAO,OAAO,CAAC,IAAI,CAAC,CAAC;AAC7B,OAAO,CAAC,CAAC;AACT,KAAK,CAAC,CAAC;AACP,GAAG,CAAC,CAAC;AACL,CAAC;AACD,eAAe,IAAI,CAAC,EAAE,OAAO,EAAE,EAAE;AACjC,EAAE,IAAI,YAAY,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACzC,EAAE,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;AAC5B,EAAE,IAAI,UAAU,GAAG,SAAS,EAAE,CAAC;AAC/B,EAAE,IAAI,YAAY,EAAE;AACpB,IAAI,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;AAC1C,GAAG,MAAM;AACT,IAAI,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;AAC9B,GAAG;AACH,EAAE,IAAI,UAAU,GAAG,MAAM,cAAc,EAAE,CAAC;AAC1C,EAAE,IAAI;AACN,IAAI,IAAI,SAAS,GAAG,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,EAAE,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC;AAChE,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,KAAK,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;AACtD,MAAM,IAAI,GAAG,GAAG,MAAM,UAAU,CAAC,KAAK,CAAC,CAAC,oCAAoC,EAAE,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK;AACpI,QAAQ,OAAO,IAAI,CAAC;AACpB,OAAO,CAAC,CAAC;AACT,MAAM,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,EAAE,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC,CAAC;AACnG,KAAK;AACL,IAAI,IAAI,eAAe,GAAG,MAAM,aAAa,EAAE,CAAC;AAChD,IAAI,SAAS,CAAC,OAAO,GAAG,eAAe,CAAC;AACxC,IAAI,OAAO,SAAS,CAAC;AACrB,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,0BAA0B,CAAC,CAAC;AAC9C,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACvB,IAAI,OAAO,KAAK,CAAC;AACjB,GAAG;AACH,CAAC;AACD,MAAM,OAAO,GAAG;AAChB,EAAE,MAAM,EAAE,OAAO,OAAO,KAAK;AAC7B,IAAI,MAAM,SAAS,GAAG,MAAM,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;AACvD,IAAI,IAAI,WAAW,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AAC5C,IAAI,IAAI,QAAQ,GAAG,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACxC,IAAI,IAAI,YAAY,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACnD,IAAI,IAAI,WAAW,GAAG,SAAS,EAAE,CAAC;AAClC,IAAI,IAAI,EAAE,YAAY,IAAI,IAAI,IAAI,YAAY,IAAI,EAAE,CAAC,EAAE;AACvD,MAAM,IAAI,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;AACjD,MAAM,WAAW,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,KAAK;AAC1C,QAAQ,IAAI,IAAI,CAAC,IAAI,IAAI,WAAW,EAAE;AACtC,UAAU,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;AACpC,YAAY,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;AACxC,YAAY,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACzC,WAAW;AACX,SAAS,MAAM;AACf,UAAU,WAAW,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACvC,SAAS;AACT,OAAO,CAAC,CAAC;AACT,MAAM,IAAI,WAAW,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,EAAE;AACzC,QAAQ,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;AACtD,QAAQ,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;AAC/B,OAAO,MAAM;AACb,QAAQ,IAAI,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;AACxD,QAAQ,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;AACnC,QAAQ,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,aAAa,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;AAClE,QAAQ,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;AAC/B,OAAO;AACP,KAAK;AACL,GAAG;AACH,CAAC;;;;;;;;AC3EW,MAAC,KAAK,GAAG,EAAE;AACvB,IAAI,eAAe,CAAC;AACR,MAAC,SAAS,GAAG,YAAY,eAAe,KAAK,CAAC,MAAM,OAAO,4BAAuC,CAAC,EAAE,QAAQ;AAE7G,MAAC,SAAS,GAAG,kCAAkC;AAC/C,MAAC,OAAO,GAAG,CAAC,oCAAoC,CAAC,sCAAsC,CAAC,yCAAyC,CAAC,wCAAwC,CAAC,2CAA2C,EAAE;AACxN,MAAC,WAAW,GAAG,GAAG;AAClB,MAAC,KAAK,GAAG;;;;"}